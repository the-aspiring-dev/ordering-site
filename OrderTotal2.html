<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zhuo Yue Labs Ordering Site</title>

  <!-- PDF libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* Enforce Inter font across the site */
    body, button, input, textarea, select,
    h1, h2, h3, h4, h5, h6,
    .brandTitle, .totTitle, .badge,
    .btnPrimary, .btnAlt, .btnGhost,
    .footerInner, .homeTop {
      font-family: 'Inter', sans-serif !important;
    }
    :root{
      --bg:#0b0d10;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.09);
      --border: rgba(255,255,255,0.12);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
      --muted2: rgba(255,255,255,0.55);
      --brand:#e40000;
      --brand2:#ff2a2a;
      --bad:#ff4d4d;
      --good:#22c55e;
      --shadow: 0 18px 45px rgba(0,0,0,0.45);
      --shadow2: 0 10px 25px rgba(0,0,0,0.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --radius: 16px;
      --focus: 0 0 0 3px rgba(228,0,0,0.25);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    /* FIX: remove bottom red bar by keeping glow top-focused and fading to solid bg */
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: clamp(12px, 3vw, 22px);
      position: relative;
      overflow-x: hidden;
    }
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
      background:
        radial-gradient(1200px 600px at 15% -10%, rgba(228,0,0,0.26), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(255,42,42,0.14), transparent 60%),
        radial-gradient(800px 520px at 45% -12%, rgba(255,255,255,0.06), transparent 62%),
        linear-gradient(to bottom, rgba(11,13,16,0) 0%, rgba(11,13,16,0) 55%, rgba(11,13,16,1) 85%, rgba(11,13,16,1) 100%);
      background-repeat: no-repeat;
      background-size: cover;
    }

    .wrap{ max-width: 1180px; margin: 0 auto; }
    .topbar{
      display:flex;
      gap: 14px;
      align-items: stretch;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .brand{
      flex: 1;
      min-width: 320px;
      background: linear-gradient(135deg, rgba(228,0,0,0.95), rgba(255,42,42,0.75));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 18px 16px 18px;
      position: relative;
      overflow:hidden;
    }
    .brand::after{
      content:"";
      position:absolute;
      inset:-30% -10% auto auto;
      width: 340px;
      height: 340px;
      border-radius: 50%;
      background: rgba(0,0,0,0.18);
      transform: rotate(10deg);
    }
    .brandTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      position:relative;
      z-index:1;
    }
    .brandTitle{
      font-family: Montserrat, Inter, sans-serif;
      font-weight: 900;
      letter-spacing: 0.5px;
      font-size: 24px;
      line-height: 1.12;
      margin:0;
      text-transform: uppercase;
    }
    .brandSub{
      margin-top: 7px;
      font-size: 12px;
      color: rgba(255,255,255,0.86);
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      align-items:center;
      position:relative;
      z-index:1;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.18);
      font-weight: 800;
    }
    .pill b{ font-family: var(--mono); font-weight: 900; }

    .logoSlot{
      width: 88px;
      height: 88px;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(0,0,0,0.18);
      overflow:hidden;
      flex-shrink:0;
      display:none !important; /* icon/pfp hidden */
    }
    .logoSlot img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    .heroSlot{
      margin-top: 10px;
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 14px;
      overflow:hidden;
      display:none;
      position:relative;
      z-index:1;
    }
    .heroSlot img{ width:100%; display:block; }

    .helpLine{
      margin-top: 10px;
      color: rgba(255,255,255,0.86);
      font-size: 12px;
      line-height: 1.35;
      position:relative;
      z-index:1;
    }
    .mini{
      font-size: 11px;
      color: rgba(255,255,255,0.75);
      font-family: var(--mono);
    }

    .sideTotals{
      width: 420px;
      min-width: 320px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding: 14px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.22);
      font-weight: 900;
      font-size: 11px;
      font-family: var(--mono);
      color: rgba(255,255,255,0.85);
      letter-spacing: 0.2px;
      text-transform: uppercase;
      white-space: nowrap;
    }

    .divider{ height:1px; background: rgba(255,255,255,0.12); margin: 10px 0; }

    .totCard{
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: var(--radius);
      padding: 14px;
    }
    .totTitle{
      font-family: Montserrat, Inter, sans-serif;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 12px;
      color: rgba(255,255,255,0.82);
      margin: 0 0 10px 0;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 8px;
    }
    .totTable{ width:100%; border-collapse: collapse; margin:0; }
    .totTable td{
      padding: 7px 0;
      border:0;
      font-size: 12px;
      color: rgba(255,255,255,0.80);
      vertical-align: top;
    }
    .totTable td:last-child{
      text-align:right;
      font-family: var(--mono);
      font-weight: 900;
      font-size: 13px;
      color: rgba(255,255,255,0.92);
      white-space: nowrap;
    }
    .bigNumber{
      font-family: Montserrat, Inter, sans-serif;
      font-weight: 900;
      letter-spacing: 0.5px;
      font-size: 24px;
      margin-top: 8px;
      color: rgba(255,255,255,0.96);
    }

    .card{
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .cardHeader{
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .cardHeader h2{
      font-family: Montserrat, Inter, sans-serif;
      margin:0;
      font-size: 13px;
      letter-spacing: 0.6px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.85);
      font-weight: 900;
    }
    .cardBody{
      padding: 16px;
      overflow-x: auto;
    }

    label{
      display:block;
      font-size: 12px;
      font-weight: 900;
      color: rgba(255,255,255,0.78);
      margin-bottom: 6px;
    }

    input, textarea{
      width: 100%;
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 12px;
      color: var(--text);
      padding: 10px 11px;
      outline:none;
      transition: box-shadow .12s ease, border-color .12s ease;
      font-size: 13px;
    }
    input:focus, textarea:focus{
      border-color: rgba(228,0,0,0.55);
      box-shadow: var(--focus);
    }
    input[readonly], input[disabled]{ opacity: 0.82; cursor: not-allowed; }
    .inputError{
      border-color: var(--bad) !important;
      box-shadow: 0 0 0 2px rgba(255,77,77,0.35) !important;
    }
    select.countrySelect{
      width: 100%;
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 12px;
      color: var(--text);
      padding: 10px 11px;
      outline:none;
      font-size: 13px;
      font-weight: 700;
      appearance: none;
      background-image: linear-gradient(45deg, transparent 50%, rgba(255,255,255,0.6) 50%), linear-gradient(135deg, rgba(255,255,255,0.6) 50%, transparent 50%);
      background-position: calc(100% - 18px) calc(50% - 3px), calc(100% - 12px) calc(50% - 3px);
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
    }

    .row2{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .row3{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

    .ordersGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      align-items:start;
    }
    .fullWidth{ grid-column: 1 / -1; }

    .searchWrap{ position: relative; }
    .searchResults{
      position:absolute;
      top: calc(100% + 6px);
      left:0;
      right:0;
      z-index: 50;
      background: rgba(15,17,22,0.96);
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 14px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.55);
      overflow:hidden;
      max-height: 360px;
      display:none;
    }
    .resultItem{
      padding: 10px 12px;
      cursor:pointer;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      display:flex;
      justify-content: space-between;
      gap: 12px;
      align-items:flex-start;
    }
    .resultItem:hover, .resultItem.active{ background: rgba(228,0,0,0.12); }
    .resultLeft{
      display:flex;
      flex-direction:column;
      gap: 3px;
      min-width: 0;
    }
    .sku{
      font-family: var(--mono);
      font-weight: 900;
      color: rgba(255,255,255,0.92);
      font-size: 12px;
    }
    .rName{
      color: rgba(255,255,255,0.88);
      font-size: 12px;
      font-weight: 900;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 520px;
    }
    .rMeta{
      color: rgba(255,255,255,0.62);
      font-size: 11px;
      font-family: var(--mono);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    mark{
      background: rgba(255,204,0,0.22);
      color: rgba(255,255,255,0.98);
      padding: 0 2px;
      border-radius: 4px;
    }
    .resultRight{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap: 6px;
      flex-shrink:0;
    }
    .priceTag{
      font-family: var(--mono);
      font-weight: 900;
      font-size: 12px;
      color: rgba(255,255,255,0.92);
      white-space: nowrap;
    }
    .addTag{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.22);
      font-family: var(--mono);
      font-weight: 900;
      font-size: 11px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.86);
    }

    table{
      width:100%;
      border-collapse: collapse;
      margin-top: 10px;
      overflow:hidden;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
    }
    thead th{
      text-align:left;
      font-size: 12px;
      color: rgba(255,255,255,0.78);
      font-weight: 900;
      padding: 12px 12px;
      background: rgba(255,255,255,0.06);
      border-bottom: 1px solid rgba(255,255,255,0.10);
      letter-spacing: 0.4px;
      text-transform: uppercase;
      font-family: Montserrat, Inter, sans-serif;
      white-space: nowrap;
    }
    tbody td{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      vertical-align: middle;
      font-size: 13px;
    }
    tbody tr:hover{ background: rgba(255,255,255,0.03); }

    .cellMono{
      font-family: var(--mono);
      font-weight: 900;
      font-size: 12px;
      color: rgba(255,255,255,0.90);
      white-space: nowrap;
    }

    .qtyCtl{
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .qtyBtn{
      width: 34px;
      height: 34px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.22);
      color: rgba(255,255,255,0.90);
      cursor:pointer;
      font-weight: 900;
      font-family: Montserrat, Inter, sans-serif;
      transition: transform .06s ease, background .12s ease;
      user-select:none;
    }
    .qtyBtn:active{ transform: translateY(1px); }
    .qtyInput{
      width: 64px;
      text-align: right;
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.92);
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 900;
    }

    .removeBtn{
      background: rgba(255,77,77,0.12);
      border: 1px solid rgba(255,77,77,0.22);
      color: rgba(255,220,220,0.98);
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 11px;
      font-family: Montserrat, Inter, sans-serif;
      cursor:pointer;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      white-space: nowrap;
    }

    .btnRow{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
      margin-top: 12px;
    }
    button{
      border: 0;
      border-radius: 14px;
      padding: 12px 12px;
      cursor:pointer;
      font-weight: 900;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      font-family: Montserrat, Inter, sans-serif;
      font-size: 12px;
      transition: transform .06s ease, filter .12s ease;
      user-select:none;
      white-space: nowrap;
    }
    button:active{ transform: translateY(1px); }
    .btnPrimary{ background: linear-gradient(135deg, var(--brand), var(--brand2)); color:white; }
    .btnAlt{ background: linear-gradient(135deg, #b30000, #ff2a2a); color: white; }
    .btnGhost{
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.14);
      color: rgba(255,255,255,0.90);
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(15,17,22,0.96);
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: 0 18px 40px rgba(0,0,0,0.55);
      color: rgba(255,255,255,0.92);
      padding: 10px 12px;
      border-radius: 14px;
      display:none;
      gap: 10px;
      align-items:center;
      max-width: min(720px, calc(100% - 30px));
      font-size: 12px;
      z-index: 9999;
    }
    .toast .dot{
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--good);
      flex-shrink:0;
    }
    .toast.error .dot{ background: var(--bad); }
    .toast .msg{
      overflow:hidden;
      white-space:nowrap;
      text-overflow: ellipsis;
      font-weight: 800;
      letter-spacing: 0.2px;
    }
    .overlay{
      position: fixed;
      inset: 0;
      z-index: 12000;
      display:none;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .overlayBg{
      position:absolute;
      inset:0;
      background-size: cover;
      background-position: center;
      filter: blur(6px) brightness(0.55);
      transform: scale(1.05);
      transition: background-image 0.6s ease;
    }
    .overlayContent{
      position: relative;
      background: rgba(10,12,16,0.85);
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: 0 18px 50px rgba(0,0,0,0.65);
      border-radius: 18px;
      padding: 22px;
      width: min(520px, calc(100% - 32px));
      text-align: center;
      display: grid;
      gap: 16px;
    }
    .overlayText{
      font-size: 15px;
      line-height: 1.5;
      color: rgba(255,255,255,0.92);
      font-weight: 800;
    }
    .homeIntro{
      position: fixed;
      inset: 0;
      z-index: 13000;
      background: radial-gradient(1200px 600px at 20% -10%, rgba(228,0,0,0.3), transparent 60%), var(--bg);
      display: grid;
      place-items: center;
      padding: 24px;
      overflow: hidden;
    }
    .homeBg{
      position:absolute;
      inset:0;
      background-size: cover;
      background-position: center;
      opacity: 0.35;
      filter: blur(4px);
      transition: background-image 0.6s ease;
    }
    .homeInner{
      position: relative;
      z-index: 1;
      width: min(1080px, 100%);
      background: rgba(12,14,18,0.78);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 18px 45px rgba(0,0,0,0.55);
      display: grid;
      gap: 14px;
      max-height: none;
      overflow: auto;
    }
    .homeTop{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 12px;
    }
    .homeBrandMark{
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .homeLogo{
      height: 52px;
      width: 52px;
      object-fit: cover;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.18);
    }
    .homeSlogan{
      height: 42px;
      width: auto;
      object-fit: contain;
      opacity: 0.95;
    }
    .homeHeroImg img{
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: var(--shadow2);
    }
    .homeActions{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
    }
    .footer{
      margin: 18px auto 0;
      text-align: center;
    }
    .footerInner{
      display:inline-flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      padding:12px 16px;
      border-radius:12px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.82);
      font-size: 12px;
      box-shadow: var(--shadow2);
    }
    .footerInner strong{
      font-family: Montserrat, Inter, sans-serif;
      letter-spacing: 0.4px;
      font-size: 13px;
      text-transform: uppercase;
    }

    @media (max-width: 980px){
      .topbar{ flex-direction: column; }
      .sideTotals{ width: 100%; }
      .row2{ grid-template-columns: 1fr; }
      .btnRow{ grid-template-columns: 1fr; }
      .ordersGrid{ grid-template-columns: 1fr; }
      .rName{ max-width: 520px; }
    }
    @media (max-width: 768px){
      .homeInner{
        padding: 14px;
        gap: 12px;
      }
      .homeHeroImg img{ border-radius: 12px; }
      .homeActions{ grid-template-columns: 1fr; }
      .sideTotals{ width: 100%; }
      .cardBody{ padding: 14px; }
      .homeIntro{ padding: 14px; }
    }
  </style>
</head>

<body>
  <div class="homeIntro" id="homeIntro">
    <div class="homeBg" id="homeBg"></div>
      <div class="homeInner">
        <div class="homeTop">
          <div class="homeBrandMark">
            <img class="homeLogo" src="zyl-logo.png" alt="Zhuo Yue Labs logo" />
            <img class="homeSlogan" src="slogan.png" alt="Zhuo Yue Labs slogan" />
          </div>
        </div>
        <div class="homeHeroImg">
          <img src="zyl-banner.png" alt="Zhuo Yue Labs banner" />
        </div>
        <div class="homeActions">
          <button class="btnPrimary" id="homeStartBtn2">Start Order</button>
          <button class="btnAlt" id="viewProductsBtn">View Our Products</button>
        </div>
      </div>
    </div>

  <div class="wrap" id="orderApp" style="display:none;">
    <div class="topbar">
      <div class="brand">
        <div class="brandTop">
          <div>
            <h1 class="brandTitle">Zhuo Yue Labs Ordering Site</h1>
            <div class="brandSub"></div>
          </div>
          <div class="logoSlot" id="logoSlot">
            <img id="logoImg" alt="ZYL Logo" />
          </div>
          <button class="btnGhost" id="homeBtn" style="margin-left:auto;">Home</button>
        </div>

        <div class="heroSlot" id="heroSlot">
          <img id="heroImg" alt="ZYL Banner" />
        </div>

      </div>

      <div class="sideTotals">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;">
          <div>
            <div style="font-family:Montserrat,Inter,sans-serif;font-weight:900;letter-spacing:.5px;text-transform:uppercase;font-size:12px;color:rgba(255,255,255,.85);">
              Total Due
            </div>
            <div class="mini">All items (Individual + Kits) + shipping.</div>
          </div>
          <div class="badge" id="shipBadge">Shipping: $35.00</div>
        </div>

        <div class="divider"></div>

        <div class="totCard">
          <div class="totTitle">
            Summary
            <span class="badge" id="todayLabel">Date: ‚Äî</span>
          </div>
          <table class="totTable">
            <tr><td>Individual Subtotal</td><td id="subInd">$0.00</td></tr>
            <tr><td>Kits Subtotal</td><td id="subKit">$0.00</td></tr>
            <tr><td>Items Subtotal</td><td id="subAll">$0.00</td></tr>
            <tr><td>Shipping</td><td id="shipLine">$35.00</td></tr>
            <tr><td><b>Total Due</b></td><td id="totalDue"><b>$35.00</b></td></tr>
          </table>

          <div class="bigNumber" id="bigTotal">$35.00</div>
          <div class="mini" id="itemCount">0 items</div>

          <div class="btnRow" style="margin-top: 12px;">
            <button class="btnPrimary" id="pdfBtn">PDF Invoice</button>
            <button class="btnAlt" id="submitBtn">Submit Order</button>
            <button class="btnGhost" id="clearAllBtn">Clear Both Carts</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="mini">
          How do I order???<br/>
          üëá Step 1: Pick Your Items ‚Äî scroll down to Individual Vials or Kits and use the ‚ûï to add items.<br/>
          ‚úçÔ∏è Step 2: Enter Info ‚Äî fill out Your Information and pick your Country üåç so shipping calculates correctly.<br/>
          ‚úÖ Step 3: Submit ‚Äî check Total Due (top right) then hit the purple SUBMIT ORDER button! üü£
        </div>
      </div>
    </div>

    <div class="card">
      <div class="cardHeader">
        <h2>Your Information</h2>
        <div class="mini">Shipping is $35 domestically, and $65 internationally.</div>
      </div>
      <div class="cardBody">
        <div class="row2">
          <div>
            <label>Name</label>
            <input type="text" id="cName" placeholder="John Doe" />
          </div>
          <div>
            <label>Contact (Phone/Email)</label>
            <input type="text" id="cContact" placeholder="+1 ... / email" required />
          </div>
        </div>
        <div class="row2">
          <div>
            <label>Country</label>
            <select id="countrySelect" class="countrySelect">
              <option value="US">üá∫üá∏ United States</option>
              <option value="CA">üá®üá¶ Canada</option>
              <option value="GB">üá¨üáß United Kingdom</option>
              <option value="AU">üá¶üá∫ Australia</option>
              <option value="EU">üá™üá∫ European Union</option>
              <option value="OTHER">üåé Other</option>
            </select>
          </div>
          <div>
            <label>Address (optional)</label>
            <input type="text" id="cAddress" placeholder="Street, City, State, Zip" />
          </div>
        </div>
        <div class="row2">
          <div>
            <label>Shipping (auto)</label>
            <input type="text" id="shipInput" value="35.00" readonly />
          </div>
        </div>
        <div>
          <label>Notes or Questions (Optional)</label>
          <textarea id="cNotes" rows="2" placeholder="Any notes for your invoice‚Ä¶"></textarea>
        </div>
      </div>
    </div>

    <!-- TWO SEPARATE BUILD WINDOWS -->
    <div class="ordersGrid" style="margin-top:16px;">
      <!-- INDIVIDUAL WINDOW -->
      <div class="card">
      <div class="cardHeader">
        <h2>Individual Vials</h2>
        <div class="mini">Type to Search</div>
        </div>
        <div class="cardBody">
          <div class="searchWrap">
            <label>Search Catalog (Individual)</label>
            <input type="text" id="searchInd" placeholder="Type peptide name... (example Retatrutide 10mg)" autocomplete="off" />
            <div class="searchResults" id="resultsInd"></div>
          </div>

          <!-- UI Cleanup: single Amount column (no Unit column) -->
          <table>
            <thead>
              <tr>
                <th style="width: 16%;">Code</th>
                <th style="width: 50%;">Item</th>
                <th style="width: 16%;">Qty</th>
                <th style="width: 16%;">Amount $</th>
                <th style="width: 2%; text-align:right;">Act</th>
              </tr>
            </thead>
            <tbody id="bodyInd"></tbody>
          </table>

          <div class="btnRow">
            <button class="btnAlt" id="clearIndBtn">Clear Individual</button>
          </div>

          <div class="helpLine" style="margin-top:10px;">
            Individual cart is separate from Kits cart, but totals + invoice combine both.
          </div>
        </div>
      </div>

      <!-- KITS WINDOW -->
      <div class="card">
      <div class="cardHeader">
        <h2>Kits‚Äî10 vials in each</h2>
        <div class="mini">Type to Search</div>
        </div>
        <div class="cardBody">
          <div class="searchWrap">
            <label>Search Catalog (Kits)</label>
            <input type="text" id="searchKit" placeholder="Type peptide name... (example Retatrutide 10mg)" autocomplete="off" />
            <div class="searchResults" id="resultsKit"></div>
          </div>

          <!-- UI Cleanup: single Amount column (no Unit column) -->
          <table>
            <thead>
              <tr>
                <th style="width: 16%;">Code</th>
                <th style="width: 50%;">Item</th>
                <th style="width: 16%;">Qty</th>
                <th style="width: 16%;">Amount $</th>
                <th style="width: 2%; text-align:right;">Act</th>
              </tr>
            </thead>
            <tbody id="bodyKit"></tbody>
          </table>

          <div class="btnRow">
            <button class="btnAlt" id="clearKitBtn">Clear Kits</button>
          </div>

          <div class="helpLine" style="margin-top:10px;">
            Kits are separate items priced per kit (quantity = number of kits).
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer" id="pageFooter">
    <div class="footerInner">
      <strong>Zhuo Yue Labs</strong>
      <span>Precision ordering ‚Ä¢ Peptides & Kits</span>
      <span>Questions? +1 (605) 630-6296</span>
    </div>
  </div>

  <div class="toast" id="toast">
    <div class="dot"></div>
    <div class="msg" id="toastMsg">Done</div>
  </div>

  <div class="overlay" id="orderOverlay">
    <div class="overlayBg" id="overlayBg"></div>
    <div class="overlayContent">
      <div class="overlayText">üéâ Order received ‚Äî thank you!<br/>A representative from +1 (605) 630-6296 will contact you shortly via iMessage if it's a US number, or WhatsApp if it's an international order, to finalize payment and confirm the details!</div>
      <div class="btnRow">
        <button class="btnAlt" id="newOrderBtn">Submit New Order</button>
        <button class="btnGhost" id="backBtn">Go back</button>
      </div>
    </div>
  </div>

<script>
"use strict";

  /* -----------------------------
     UTIL
  ----------------------------- */
  function nnum(v){
    const x = Number(v);
    return Number.isFinite(x) ? x : 0;
  }
  function money(n){
    const x = nnum(n);
    return "$" + x.toFixed(2);
  }
  function clampInt(n, min, max){
    n = Math.floor(nnum(n));
    if (!Number.isFinite(n)) n = min;
    return Math.min(Math.max(n, min), max);
  }
  function toast(msg, type="info"){
    const t = document.getElementById("toast");
    const m = document.getElementById("toastMsg");
    m.textContent = msg;
    t.classList.remove("error");
    if (type === "error") t.classList.add("error");
    t.style.display = "flex";
    clearTimeout(toast._timer);
    toast._timer = setTimeout(() => { t.style.display = "none"; }, 1600);
  }
  function norm(s){ return String(s || "").trim().toLowerCase(); }
  function tokenize(q){ return norm(q).split(/\s+/).filter(Boolean); }
  function escapeHTML(s){
    return String(s || "")
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;")
      .replace(/'/g,"&#039;");
  }
  function highlight(text, q){
    const tokens = tokenize(q);
    if (!tokens.length) return escapeHTML(text);
    let out = escapeHTML(text);
    tokens.forEach(t => {
      if (!t) return;
      const re = new RegExp("(" + t.replace(/[.*+?^${}()|[\]\\]/g, "\\$&") + ")", "ig");
      out = out.replace(re, "<mark>$1</mark>");
    });
    return out;
  }

  /* -----------------------------
     OPTIONAL IMAGE AUTO-LOAD
  ----------------------------- */
  (function tryLoadImages(){
    // logo intentionally hidden
    const logo = document.getElementById("logoImg");
    const logoSlot = document.getElementById("logoSlot");
    if (logo && logoSlot){
      logoSlot.style.display = "none";
    }

    const hero = document.getElementById("heroImg");
    const heroSlot = document.getElementById("heroSlot");
    hero.onload = () => { heroSlot.style.display = "block"; };
    hero.onerror = () => { heroSlot.style.display = "none"; };
    hero.src = "zyl-banner.png";
  })();

  /* -----------------------------
     CONFIG
     - Shipping starts at $35
     - EmailJS initialized with placeholder key
  ----------------------------- */
  const DEFAULT_SHIPPING = 35.00;
  let shippingRate = DEFAULT_SHIPPING;

  try{
    if (window.emailjs && emailjs.init){
      emailjs.init("KTNdzoK5C_9WtBjT1"); // <-- replace with your EmailJS public key
    }
  } catch(_e){}

  // Replace these arrays with your real catalogs.
  // Each item: { sku: "CODE", name: "Product Name", price: 12.34 }
  const CATALOG_INDIVIDUAL = [
    { sku: "TR20-S", name: "Tirzepatide 20mg (1 Vial)", cost: 23.63, price: 65.00 },
    { sku: "TR30-S", name: "Tirzepatide 30mg (1 Vial)", cost: 28.88, price: 80.00 },
    { sku: "TR40-S", name: "Tirzepatide 40mg (1 Vial)", cost: 34.13, price: 95.00 },
    { sku: "SM10-S", name: "Semaglutide 10mg (1 Vial)", cost: 21.88, price: 60.00 },
    { sku: "RT10-S", name: "Retatrutide 10mg (1 Vial)", cost: 23.63, price: 65.00 },
    { sku: "RT15-S", name: "Retatrutide 15mg (1 Vial)", cost: 30.63, price: 85.00 },
    { sku: "RT20-S", name: "Retatrutide 20mg (1 Vial)", cost: 39.38, price: 110.00 },
    { sku: "RT50-S", name: "Retatrutide 50mg (1 Vial)", cost: 78.75, price: 215.00 },
    { sku: "RT60-S", name: "Retatrutide 60mg (1 Vial)", cost: 96.25, price: 260.00 },
    { sku: "BBG70-S", name: "Glow 70mg (1 Vial)", cost: 35.00, price: 95.00 },
    { sku: "KLOW80-S", name: "Klow 80mg (1 Vial)", cost: 35.00, price: 95.00 },
    { sku: "BB20-S", name: "BPC/TB Blend 20mg (1 Vial)", cost: 35.00, price: 95.00 },
    { sku: "5AM-S", name: "5-Amino-1mq 50mg (1 Vial)", cost: 26.25, price: 75.00 },
    { sku: "CP10-S", name: "CJC/IPA Blend 10mg (1 Vial)", cost: 26.25, price: 75.00 },
    { sku: "SK10-S", name: "Selank 10mg (1 Vial)", cost: 21.88, price: 60.00 },
    { sku: "KPV10-S", name: "KPV 10mg (1 Vial)", cost: 21.88, price: 60.00 },
    { sku: "P41-S", name: "PT-141 10mg (1 Vial)", cost: 21.88, price: 60.00 },
    { sku: "MT1-S", name: "Melanotan 1 10mg (1 Vial)", cost: 26.25, price: 75.00 },
    { sku: "NJ500-S", name: "NAD+ 500mg (1 Vial)", cost: 21.88, price: 60.00 },
    { sku: "MS10-S", name: "MOTS-C 10mg (1 Vial)", cost: 21.88, price: 60.00 },
    { sku: "GT1500-S", name: "Glutathione 1.5g (1 Vial)", cost: 26.25, price: 75.00 },
    { sku: "TSM10-S", name: "Tesamorelin 10mg (1 Vial)", cost: 35.00, price: 95.00 },
    { sku: "CU50-S", name: "GHK-Cu 50mg (1 Vial)", cost: 17.50, price: 50.00 },
    { sku: "MT2-S", name: "Melanotan 2 10mg (1 Vial)", cost: 21.88, price: 60.00 },
    { sku: "G5K-S", name: "HCG 5000iu (1 Vial)", cost: 26.25, price: 75.00 },
    { sku: "HOSP", name: "Hospira Water 30ml", cost: 15.00, price: 50.00 },
    { sku: "LIPO-S", name: "Lipo C 216mg (1 Vial)", cost: 26.25, price: 75.00 },
    { sku: "H10-S", name: "HGH 10iu (1 Vial)", cost: 0.00, price: 20.00 }
  ];

  const CATALOG_KITS = [
    { sku: "RT5", name: "Retatrutide 5mg", cost: 50.00, price: 129.00 },
    { sku: "RT10", name: "Retatrutide 10mg", cost: 76.00, price: 207.00 },
    { sku: "RT15", name: "Retatrutide 15mg", cost: 105.00, price: 283.50 },
    { sku: "RT20", name: "Retatrutide 20mg", cost: 130.00, price: 379.50 },
    { sku: "RT30", name: "Retatrutide 30mg", cost: 195.00, price: 448.50 },
    { sku: "RT50", name: "Retatrutide 50mg", cost: 270.00, price: 559.50 },
    { sku: "RT60", name: "Retatrutide 60mg", cost: 325.00, price: 607.50 },
    { sku: "SM5", name: "Semaglutide 5mg", cost: 32.00, price: 85.50 },
    { sku: "SM10", name: "Semaglutide 10mg", cost: 42.00, price: 111.00 },
    { sku: "SM15", name: "Semaglutide 15mg", cost: 54.00, price: 145.50 },
    { sku: "SM20", name: "Semaglutide 20mg", cost: 82.00, price: 172.50 },
    { sku: "SM30", name: "Semaglutide 30mg", cost: 99.00, price: 207.00 },
    { sku: "SM50", name: "Semaglutide 50mg", cost: 125.00, price: 250.00 },
    { sku: "TR5", name: "Tirzepatide 5mg", cost: 30.00, price: 76.50 },
    { sku: "TR10", name: "Tirzepatide 10mg", cost: 48.00, price: 120.00 },
    { sku: "TR20", name: "Tirzepatide 20mg", cost: 78.00, price: 189.00 },
    { sku: "TR30", name: "Tirzepatide 30mg", cost: 107.00, price: 223.50 },
    { sku: "TR40", name: "Tirzepatide 40mg", cost: 136.00, price: 276.00 },
    { sku: "TR50", name: "Tirzepatide 50mg", cost: 166.00, price: 345.00 },
    { sku: "TR60", name: "Tirzepatide 60mg", cost: 191.00, price: 396.00 },
    { sku: "TR80", name: "Tirzepatide 80mg", cost: 288.00, price: 576.00 },
    { sku: "TR100", name: "Tirzepatide 100mg", cost: 321.00, price: 642.00 },

    { sku: "Adamax5", name: "Adamax 5mg", cost: 60.00, price: 120.00 },
    { sku: "Adamax10", name: "Adamax 10mg", cost: 95.00, price: 190.00 },

    { sku: "AE1", name: "ACE-031 1mg", cost: 196.00, price: 392.00 },
    { sku: "AP5", name: "Adipotide 5mg", cost: 115.00, price: 230.00 },
    { sku: "AP10", name: "Adipotide 10mg", cost: 166.00, price: 332.00 },
    { sku: "AR50", name: "AICAR 50mg", cost: 50.00, price: 100.00 },

    { sku: "5AM", name: "5-Amino-1mq 5mg", cost: 52.00, price: 138.00 },
    { sku: "AOD2", name: "AOD9604 2mg", cost: 36.00, price: 72.00 },
    { sku: "AOD5", name: "AOD9604 5mg", cost: 70.00, price: 140.00 },
    { sku: "AOD10", name: "AOD9604 10mg", cost: 123.00, price: 246.00 },

    { sku: "RA10", name: "Ara-290 10mg", cost: 52.00, price: 104.00 },

    { sku: "WA3", name: "Acetic Acid 3ml", cost: 8.00, price: 16.00 },
    { sku: "WA10", name: "Acetic Acid 10ml", cost: 12.00, price: 24.00 },
    { sku: "BA3", name: "Bacteriostatic Water 3ml", cost: 8.00, price: 16.00 },
    { sku: "BA10", name: "Bacteriostatic Water 10ml", cost: 12.00, price: 24.00 },

    { sku: "B7-33-2", name: "B7-33 2mg", cost: 45.00, price: 90.00 },

    { sku: "BC2", name: "BPC157 2mg", cost: 21.00, price: 42.00 },
    { sku: "BC5", name: "BPC157 5mg", cost: 31.00, price: 85.50 },
    { sku: "BC10", name: "BPC157 10mg", cost: 52.00, price: 138.00 },

    { sku: "BB10", name: "BPC5mg+TB5mg", cost: 82.00, price: 198.00 },
    { sku: "BB20", name: "BPC10mg+TB10mg", cost: 149.00, price: 379.50 },
    { sku: "BBG70", name: "Glow (BPC+GHK+TB)", cost: 153.00, price: 390.00 },

    { sku: "Bron", name: "Bronchogen 20mg", cost: 84.00, price: 168.00 },

    { sku: "CGL5", name: "Cagrilintide 5mg", cost: 89.00, price: 223.50 },
    { sku: "CGL10", name: "Cagrilintide 10mg", cost: 140.00, price: 414.00 },
    { sku: "CS10", name: "Cagrilintide 5+Sema 5", cost: 149.00, price: 298.00 },

    { sku: "Cardio", name: "Cardiogen 20mg", cost: 81.00, price: 162.00 },
    { sku: "Cartalax", name: "Cartalax 20mg", cost: 85.00, price: 170.00 },
    { sku: "Cortagen", name: "Cortagen 20mg", cost: 85.00, price: 170.00 },
    { sku: "Crystagen", name: "Crystagen 20mg", cost: 60.00, price: 120.00 },

    { sku: "CND2", name: "CJC-1295 no DAC 2mg", cost: 38.00, price: 76.00 },
    { sku: "CND5", name: "CJC-1295 no DAC 5mg", cost: 77.00, price: 172.50 },
    { sku: "CND10", name: "CJC-1295 no DAC 10mg", cost: 113.00, price: 310.50 },

    { sku: "CD2", name: "CJC-1295 DAC 2mg", cost: 50.00, price: 100.00 },
    { sku: "CD5", name: "CJC-1295 DAC 5mg", cost: 120.00, price: 292.50 },

    { sku: "DS2", name: "DSIP 2mg", cost: 20.00, price: 40.00 },
    { sku: "DS10", name: "DSIP 10mg", cost: 70.00, price: 140.00 },

    { sku: "Dula5", name: "Dulaglutide 5mg", cost: 145.00, price: 290.00 },
    { sku: "Dula10", name: "Dulaglutide 10mg", cost: 238.00, price: 476.00 },

    { sku: "ET10", name: "Epithalon 10mg", cost: 35.00, price: 118.50 },
    { sku: "ET50", name: "Epithalon 50mg", cost: 135.00, price: 345.00 },

    { sku: "FOX10", name: "FOX04-DRI 10mg", cost: 330.00, price: 690.00 },

    { sku: "GDF8", name: "GDF-8 1mg", cost: 161.00, price: 322.00 },

    { sku: "CU50", name: "GHK-CU 50mg", cost: 28.00, price: 60.00 },
    { sku: "CU100", name: "GHK-CU 100mg", cost: 52.00, price: 120.00 },

    { sku: "GTT500", name: "Glutathione 600mg", cost: 38.00, price: 76.00 },
    { sku: "GT1500", name: "Glutathione 1500mg", cost: 80.00, price: 145.50 },

    { sku: "Gonad", name: "Gonadorelin 5mg", cost: 38.00, price: 76.00 },

    { sku: "G25", name: "GHRP-2 5mg", cost: 22.00, price: 44.00 },
    { sku: "G210", name: "GHRP-2 10mg", cost: 38.00, price: 76.00 },

    { sku: "G65", name: "GHRP-6 5mg", cost: 22.00, price: 60.00 },
    { sku: "G610", name: "GHRP-6 10mg", cost: 38.00, price: 94.50 },

    { sku: "G5K", name: "HCG 5000iu", cost: 64.00, price: 128.00 },
    { sku: "G2K", name: "HCG 2000iu", cost: 31.00, price: 62.00 },

    { sku: "HX2", name: "Hexarelin 2mg", cost: 40.00, price: 80.00 },
    { sku: "HX5", name: "Hexarelin 5mg", cost: 72.00, price: 172.50 },

    { sku: "H10", name: "HGH 10iu", cost: 40.00, price: 111.00 },
    { sku: "H15", name: "HGH 15iu", cost: 67.00, price: 189.00 },
    { sku: "H24", name: "HGH 24iu", cost: 105.00, price: 210.00 },

    { sku: "FR2", name: "HGH Frag 176-191 2mg", cost: 39.00, price: 78.00 },
    { sku: "FR5", name: "HGH Frag 176-191 5mg", cost: 73.00, price: 146.00 },

    { sku: "G75", name: "HMG 75iu", cost: 58.00, price: 116.00 },

    { sku: "Hum", name: "Humanin 10mg", cost: 238.00, price: 476.00 },

    { sku: "IGF01", name: "IGF-1 LR3 0.1mg", cost: 38.00, price: 76.00 },
    { sku: "IGF1", name: "IGF-1 LR3 1mg", cost: 152.00, price: 304.00 },
    { sku: "IGD", name: "IGF-DES 1mg", cost: 35.00, price: 70.00 },

    { sku: "IP5", name: "Ipamorelin 5mg", cost: 39.00, price: 75.00 },
    { sku: "IP10", name: "Ipamorelin 10mg", cost: 64.00, price: 154.50 },

    { sku: "KS5", name: "KissPeptin-10 5mg", cost: 39.00, price: 78.00 },
    { sku: "KS10", name: "KissPeptin-10 10mg", cost: 69.00, price: 138.00 },

    { sku: "KPV10", name: "KPV 10mg", cost: 60.00, price: 120.00 },

    { sku: "KLOW80", name: "Klow80", cost: 179.00, price: 483.00 },

    { sku: "LC200", name: "L-Carnitine 200mg", cost: 30.00, price: 60.00 },
    { sku: "LC400", name: "L-Carnitine 400mg", cost: 40.00, price: 0.00 },
    { sku: "LC600", name: "L-Carnitine 600mg", cost: 42.00, price: 84.00 },
    { sku: "LC1200", name: "L-Carnitine 1200mg", cost: 50.00, price: 100.00 },

    { sku: "MIC", name: "Lipo-C (MIC+B12)", cost: 80.00, price: 160.00 },

    { sku: "Lemon", name: "Lemon Bottle", cost: 52.00, price: 138.00 },

    { sku: "Lira5", name: "Liraglutide 5mg", cost: 69.00, price: 138.00 },
    { sku: "Lira10", name: "Liraglutide 10mg", cost: 128.00, price: 256.00 },
    { sku: "Lira30", name: "Liraglutide 30mg", cost: 324.00, price: 648.00 },

    { sku: "LL37", name: "LL37 5mg", cost: 69.00, price: 138.00 },

    { sku: "MAZ5", name: "Mazdutide 5mg", cost: 81.00, price: 162.00 },
    { sku: "MAZ10", name: "Mazdutide 10mg", cost: 60.00, price: 361.50 },
    { sku: "MAZ20", name: "Mazdutide 20mg", cost: 273.00, price: 546.00 },

    { sku: "MT1", name: "Melanotan 1", cost: 41.00, price: 82.00 },
    { sku: "MT2", name: "Melanotan 2", cost: 41.00, price: 82.00 },

    { sku: "FM2", name: "MGF 2mg", cost: 33.00, price: 66.00 },

    { sku: "MS10", name: "MOTS-C 10mg", cost: 50.00, price: 129.00 },
    { sku: "MS40", name: "MOTS-C 40mg", cost: 145.00, price: 360.00 },

    { sku: "NJ100", name: "NAD+ 100mg", cost: 41.00, price: 82.00 },
    { sku: "NJ500", name: "NAD+ 500mg", cost: 77.00, price: 154.00 },

    { sku: "OT10", name: "Oxytocin 10mg", cost: 65.00, price: 130.00 },

    { sku: "P21", name: "P21 5mg", cost: 255.00, price: 510.00 },

    { sku: "PIN10", name: "Pinealon 10mg", cost: 49.00, price: 98.00 },

    { sku: "PTD", name: "PTD-DBM 1mg", cost: 51.00, price: 102.00 },

    { sku: "P41", name: "PT-141 10mg", cost: 56.00, price: 112.00 },

    { sku: "PE10", name: "PE-22-28 10mg", cost: 68.00, price: 136.00 },

    { sku: "FMP2", name: "PEG-MGF 2mg", cost: 68.00, price: 136.00 },

    { sku: "SM02", name: "Sermorelin 2mg", cost: 45.00, price: 90.00 },
    { sku: "SM05", name: "Sermorelin 5mg", cost: 50.00, price: 138.00 },
    { sku: "SM010", name: "Sermorelin 10mg", cost: 128.00, price: 207.00 },

    { sku: "2S10", name: "SS-31 10mg", cost: 70.00, price: 189.00 },
    { sku: "2S50", name: "SS-31 50mg", cost: 273.00, price: 705.00 },

    { sku: "XA5", name: "Semax 5mg", cost: 40.00, price: 75.00 },
    { sku: "XA10", name: "Semax 10mg", cost: 58.00, price: 111.00 },

    { sku: "SK5", name: "Selank 5mg", cost: 40.00, price: 85.50 },
    { sku: "SK10", name: "Selank 10mg", cost: 58.00, price: 129.00 },

    { sku: "NP810", name: "SNAP-8 10mg", cost: 35.00, price: 75.00 },

    { sku: "332", name: "SLU-PP-332 5mg", cost: 81.00, price: 162.00 },

    { sku: "SUR10", name: "Survodutide 10mg", cost: 187.00, price: 600.00 },

    { sku: "TB5", name: "TB500 5mg", cost: 64.00, price: 154.50 },
    { sku: "TB10", name: "TB500 10mg", cost: 124.00, price: 276.00 },

    { sku: "TSM2", name: "Tesamorelin 2mg", cost: 40.00, price: 80.00 },
    { sku: "TSM5", name: "Tesamorelin 5mg", cost: 80.00, price: 207.00 },
    { sku: "TSM10", name: "Tesamorelin 10mg", cost: 147.00, price: 379.50 },
    { sku: "TSM20", name: "Tesamorelin 20mg", cost: 290.00, price: 580.00 },

    { sku: "TY", name: "Thymalin 10mg", cost: 55.00, price: 110.00 },

    { sku: "TA2", name: "Thymosin Alpha-1 2mg", cost: 32.00, price: 64.00 },
    { sku: "TA5", name: "Thymosin Alpha-1 5mg", cost: 89.00, price: 178.00 },
    { sku: "TA10", name: "Thymosin Alpha-1 10mg", cost: 128.00, price: 256.00 },

    { sku: "VIP10", name: "VIP 10mg", cost: 110.00, price: 220.00 },

    { sku: "Ves", name: "Vesugen 10mg", cost: 55.00, price: 110.00 },

    { sku: "Pira", name: "Piracetam 800mg", cost: 0.00, price: 120.00 },
    { sku: "Ani", name: "Aniracetam 200mg", cost: 0.00, price: 180.00 },
    { sku: "Oxi", name: "Oxiracetam 750mg", cost: 0.00, price: 150.00 },
    { sku: "Prami", name: "Pramiracetam 300mg", cost: 0.00, price: 220.00 },
    { sku: "PhenP", name: "Phenylpiracetam 100mg", cost: 0.00, price: 250.00 },
    { sku: "Colu", name: "Coluracetam 20mg", cost: 0.00, price: 280.00 },
    { sku: "Nefi", name: "Nefiracetam 400mg", cost: 0.00, price: 200.00 },
    { sku: "Leve", name: "Levetiracetam 500mg", cost: 0.00, price: 160.00 },
    { sku: "Faso", name: "Fasoracetam 50mg", cost: 0.00, price: 240.00 },
    { sku: "Noop", name: "Noopept 10mg", cost: 0.00, price: 180.00 },
    { sku: "Pheni", name: "Phenibut 250mg", cost: 0.00, price: 140.00 },
    { sku: "Centro", name: "Centrophenoxine 300mg", cost: 0.00, price: 170.00 },
    { sku: "Cereb", name: "Cerebrolysin 10mg", cost: 0.00, price: 140.00 }
  ];

  /* -----------------------------
     STATE (two separate carts)
  ----------------------------- */
  const cartInd = new Map();
  const cartKit = new Map();

  const STORAGE_KEY = "zyl_order_dual_cart_v2";

  const els = {
    // totals
    shipBadge: document.getElementById("shipBadge"),
    todayLabel: document.getElementById("todayLabel"),
    subInd: document.getElementById("subInd"),
    subKit: document.getElementById("subKit"),
    subAll: document.getElementById("subAll"),
    shipLine: document.getElementById("shipLine"),
    totalDue: document.getElementById("totalDue"),
    bigTotal: document.getElementById("bigTotal"),
    itemCount: document.getElementById("itemCount"),

    // info
    cName: document.getElementById("cName"),
    cContact: document.getElementById("cContact"),
    cAddress: document.getElementById("cAddress"),
    cNotes: document.getElementById("cNotes"),
    shipInput: document.getElementById("shipInput"),
    countrySelect: document.getElementById("countrySelect"),

    // individual ui
    searchInd: document.getElementById("searchInd"),
    resultsInd: document.getElementById("resultsInd"),
    bodyInd: document.getElementById("bodyInd"),
    clearIndBtn: document.getElementById("clearIndBtn"),

    // kits ui
    searchKit: document.getElementById("searchKit"),
    resultsKit: document.getElementById("resultsKit"),
    bodyKit: document.getElementById("bodyKit"),
    clearKitBtn: document.getElementById("clearKitBtn"),

    // global
    pdfBtn: document.getElementById("pdfBtn"),
    clearAllBtn: document.getElementById("clearAllBtn"),
    submitBtn: document.getElementById("submitBtn"),
    overlay: document.getElementById("orderOverlay"),
    overlayBg: document.getElementById("overlayBg"),
    newOrderBtn: document.getElementById("newOrderBtn"),
    backBtn: document.getElementById("backBtn"),
  };

  /* -----------------------------
     VALIDATION (Contact required)
  ----------------------------- */
  function requireContact(){
    const contact = (els.cContact.value || "").trim();
    if (contact){
      els.cContact.classList.remove("inputError");
      return contact;
    }
    els.cContact.classList.add("inputError");
    toast("Please enter a contact number/email", "error");
    els.cContact.focus();
    setTimeout(() => els.cContact.classList.remove("inputError"), 1400);
    return "";
  }

  function setCountryShipping(code){
    const c = String(code || "US").toUpperCase();
    const rate = (c === "US") ? 35 : 65;
    shippingRate = rate;
    els.shipInput.value = rate.toFixed(2);
    els.shipBadge.textContent = "Shipping: " + money(rate);
    els.shipLine.textContent = money(rate);
    renderTotals();
  }

  /* -----------------------------
     PERSISTENCE
  ----------------------------- */
  function persist(){
    const payload = {
      ind: Array.from(cartInd.values()),
      kit: Array.from(cartKit.values()),
      info: {
        name: (els.cName.value || "").trim(),
        contact: (els.cContact.value || "").trim(),
        address: (els.cAddress.value || "").trim(),
        notes: (els.cNotes.value || "").trim(),
        country: (els.countrySelect.value || "US")
      }
    };
    sessionStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
  }

  function loadPersisted(){
    const raw = sessionStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    try{
      const obj = JSON.parse(raw);
      if (obj && Array.isArray(obj.ind)){
        obj.ind.forEach(it => {
          if (!it || !it.sku) return;
          cartInd.set(String(it.sku), {
            sku: String(it.sku),
            name: String(it.name || ""),
            price: nnum(it.price),
            qty: clampInt(it.qty, 1, 999)
          });
        });
      }
      if (obj && Array.isArray(obj.kit)){
        obj.kit.forEach(it => {
          if (!it || !it.sku) return;
          cartKit.set(String(it.sku), {
            sku: String(it.sku),
            name: String(it.name || ""),
            price: nnum(it.price),
            qty: clampInt(it.qty, 1, 999)
          });
        });
      }
      if (obj && obj.info){
        els.cName.value = obj.info.name || "";
        els.cContact.value = obj.info.contact || "";
        els.cAddress.value = obj.info.address || "";
        els.cNotes.value = obj.info.notes || "";
        if (obj.info.country) els.countrySelect.value = obj.info.country;
      }
    }catch(_e){}
  }

  /* -----------------------------
     SEARCH ENGINE (reusable)
  ----------------------------- */
  function scoreItem(item, q){
    const term = norm(q);
    const sku = norm(item.sku);
    const name = norm(item.name);
    if (!term) return 999;

    const tokens = tokenize(term);
    const hay = (sku + " " + name);
    for (const t of tokens){
      if (!hay.includes(t)) return 9999;
    }

    if (sku === term) return 0;
    if (sku.startsWith(term)) return 1;
    if (name.startsWith(term)) return 2;
    if (sku.includes(term)) return 3;
    if (name.includes(term)) return 4;
    return 10;
  }

  function attachSearch({ inputEl, resultsEl, catalog, onAdd }){
    let activeIndex = -1;
    let lastResults = [];

    function setActiveIndex(i){
      activeIndex = i;
      const nodes = resultsEl.querySelectorAll(".resultItem");
      nodes.forEach(n => n.classList.remove("active"));
      if (i >= 0 && i < nodes.length){
        nodes[i].classList.add("active");
        const parent = resultsEl;
        const el = nodes[i];
        const top = el.offsetTop;
        const bottom = top + el.offsetHeight;
        if (top < parent.scrollTop) parent.scrollTop = top;
        if (bottom > parent.scrollTop + parent.clientHeight) parent.scrollTop = bottom - parent.clientHeight;
      }
    }

    function hide(){
      resultsEl.style.display = "none";
      resultsEl.innerHTML = "";
      lastResults = [];
      activeIndex = -1;
    }

    function show(items, q){
      resultsEl.innerHTML = "";
      if (!items.length){
        hide();
        return;
      }
      resultsEl.style.display = "block";
      lastResults = items;
      activeIndex = -1;

      items.slice(0, 80).forEach((item, idx) => {
        const row = document.createElement("div");
        row.className = "resultItem";
        row.setAttribute("data-idx", String(idx));

        const left = document.createElement("div");
        left.className = "resultLeft";

        const sku = document.createElement("div");
        sku.className = "sku";
        sku.innerHTML = highlight(item.sku, q);

        const nm = document.createElement("div");
        nm.className = "rName";
        nm.innerHTML = highlight(item.name, q);

        const meta = document.createElement("div");
        meta.className = "rMeta";
        meta.innerHTML = `<span>Unit: <b>${money(item.price)}</b></span><span class="mini">Click to add</span>`;

        left.appendChild(sku);
        left.appendChild(nm);
        left.appendChild(meta);

        const right = document.createElement("div");
        right.className = "resultRight";
        const pr = document.createElement("div");
        pr.className = "priceTag";
        pr.textContent = money(item.price);
        const tag = document.createElement("div");
        tag.className = "addTag";
        tag.textContent = "ADD";
        right.appendChild(pr);
        right.appendChild(tag);

        row.appendChild(left);
        row.appendChild(right);

        row.addEventListener("mouseenter", () => setActiveIndex(idx));
        row.addEventListener("mouseleave", () => setActiveIndex(-1));

        row.addEventListener("click", () => {
          onAdd(String(item.sku));
          hide();
          inputEl.value = "";
          inputEl.focus();
        });

        resultsEl.appendChild(row);
      });
    }

    function run(q){
      const term = String(q || "").trim();
      if (term.length < 1){
        hide();
        return;
      }
      const ranked = catalog
        .map(it => ({...it, _score: scoreItem(it, term)}))
        .filter(it => it._score < 9999)
        .sort((a,b) => (a._score - b._score) || (a.name.length - b.name.length) || (String(a.sku).localeCompare(String(b.sku))));
      show(ranked, term);
    }

    inputEl.addEventListener("input", (e) => run(e.target.value));

    inputEl.addEventListener("keydown", (e) => {
      if (resultsEl.style.display !== "block") return;

      if (e.key === "ArrowDown"){
        e.preventDefault();
        const max = Math.min(lastResults.length, 80) - 1;
        const next = (activeIndex < max) ? activeIndex + 1 : 0;
        setActiveIndex(next);
      } else if (e.key === "ArrowUp"){
        e.preventDefault();
        const max = Math.min(lastResults.length, 80) - 1;
        const next = (activeIndex > 0) ? activeIndex - 1 : max;
        setActiveIndex(next);
      } else if (e.key === "Enter"){
        e.preventDefault();
        if (activeIndex >= 0 && activeIndex < lastResults.length){
          onAdd(String(lastResults[activeIndex].sku));
          hide();
          inputEl.value = "";
        } else if (lastResults.length === 1){
          onAdd(String(lastResults[0].sku));
          hide();
          inputEl.value = "";
        }
      } else if (e.key === "Escape"){
        hide();
      }
    });

    document.addEventListener("click", (e) => {
      if (!resultsEl.contains(e.target) && e.target !== inputEl){
        hide();
      }
    });

    return { hide, run };
  }

  /* -----------------------------
     CATALOG LOOKUPS
  ----------------------------- */
  function getFromCatalog(catalog, sku){
    const s = String(sku || "");
    return catalog.find(it => String(it.sku) === s) || null;
  }

  /* -----------------------------
     CART OPS (generic)
  ----------------------------- */
  function addToCart(cart, catalog, sku){
    const item = getFromCatalog(catalog, sku);
    if (!item) return false;

    const key = String(item.sku);
    if (cart.has(key)){
      const ex = cart.get(key);
      ex.qty = clampInt(ex.qty + 1, 1, 999);
      cart.set(key, ex);
    } else {
      cart.set(key, {
        sku: key,
        name: String(item.name),
        price: nnum(item.price),
        qty: 1
      });
    }
    persist();
    renderAll();
    toast("Added: " + key);
    return true;
  }

  function setQty(cart, sku, qty){
    const key = String(sku);
    if (!cart.has(key)) return;
    const it = cart.get(key);
    it.qty = clampInt(qty, 1, 999);
    cart.set(key, it);
    persist();
    renderAll();
  }

  function bumpQty(cart, sku, delta){
    const key = String(sku);
    if (!cart.has(key)) return;
    const it = cart.get(key);
    it.qty = clampInt(it.qty + delta, 1, 999);
    cart.set(key, it);
    persist();
    renderAll();
  }

  function removeItem(cart, sku){
    cart.delete(String(sku));
    persist();
    renderAll();
  }

  function clearCart(cart){
    cart.clear();
    persist();
    renderAll();
  }

  function clearBoth(){
    cartInd.clear();
    cartKit.clear();
    persist();
    renderAll();
    toast("Cleared both carts");
  }

  /* -----------------------------
     RENDER CART TABLE
     - UI Cleanup: NO unit cell, only Amount = price * qty
  ----------------------------- */
  function renderCartTable(cart, tbodyEl){
    tbodyEl.innerHTML = "";
    const items = Array.from(cart.values()).sort((a,b) => String(a.sku).localeCompare(String(b.sku)));

    if (!items.length){
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.colSpan = 5;
      td.style.padding = "14px 12px";
      td.innerHTML = `<span class="mini">Cart is empty ‚Äî search above to add items.</span>`;
      tr.appendChild(td);
      tbodyEl.appendChild(tr);
      return;
    }

    items.forEach(it => {
      const tr = document.createElement("tr");

      const tdSku = document.createElement("td");
      tdSku.className = "cellMono";
      tdSku.textContent = it.sku;

      const tdName = document.createElement("td");
      tdName.textContent = it.name;

      const tdQty = document.createElement("td");
      const wrap = document.createElement("div");
      wrap.className = "qtyCtl";

      const bMinus = document.createElement("button");
      bMinus.className = "qtyBtn";
      bMinus.type = "button";
      bMinus.textContent = "‚àí";
      bMinus.addEventListener("click", () => bumpQty(cart, it.sku, -1));

      const inp = document.createElement("input");
      inp.className = "qtyInput";
      inp.type = "number";
      inp.min = "1";
      inp.step = "1";
      inp.value = String(it.qty);
      inp.addEventListener("change", () => setQty(cart, it.sku, inp.value));

      const bPlus = document.createElement("button");
      bPlus.className = "qtyBtn";
      bPlus.type = "button";
      bPlus.textContent = "+";
      bPlus.addEventListener("click", () => bumpQty(cart, it.sku, +1));

      wrap.appendChild(bMinus);
      wrap.appendChild(inp);
      wrap.appendChild(bPlus);
      tdQty.appendChild(wrap);

      // Amount column = line total
      const tdLine = document.createElement("td");
      tdLine.className = "cellMono";
      tdLine.textContent = money(it.price * it.qty);

      const tdAct = document.createElement("td");
      tdAct.style.textAlign = "right";
      const rm = document.createElement("button");
      rm.className = "removeBtn";
      rm.type = "button";
      rm.textContent = "Remove";
      rm.addEventListener("click", () => removeItem(cart, it.sku));
      tdAct.appendChild(rm);

      tr.appendChild(tdSku);
      tr.appendChild(tdName);
      tr.appendChild(tdQty);
      tr.appendChild(tdLine);
      tr.appendChild(tdAct);

      tbodyEl.appendChild(tr);
    });
  }

  /* -----------------------------
     TOTALS
  ----------------------------- */
  function subtotalOf(cart){
    let s = 0;
    let count = 0;
    for (const it of cart.values()){
      const q = clampInt(it.qty, 1, 999);
      s += nnum(it.price) * q;
      count += q;
    }
    return { subtotal: s, count };
  }

  function computeTotals(){
    const ind = subtotalOf(cartInd);
    const kit = subtotalOf(cartKit);
    const itemsSubtotal = ind.subtotal + kit.subtotal;
    const shipping = itemsSubtotal > 0 ? shippingRate : 0;
    const total = itemsSubtotal + shipping;
    const count = ind.count + kit.count;
    return { ind, kit, itemsSubtotal, shipping, total, count };
  }

  function renderTotals(){
    const t = computeTotals();
    els.subInd.textContent = money(t.ind.subtotal);
    els.subKit.textContent = money(t.kit.subtotal);
    els.subAll.textContent = money(t.itemsSubtotal);
    els.shipLine.textContent = money(t.shipping);
    els.shipInput.value = t.shipping.toFixed(2);
    els.totalDue.textContent = money(t.total);
    els.bigTotal.textContent = money(t.total);
    els.itemCount.textContent = t.count + (t.count === 1 ? " item" : " items");
    els.shipBadge.textContent = "Shipping: " + money(t.shipping);
  }

  function renderAll(){
    renderCartTable(cartInd, els.bodyInd);
    renderCartTable(cartKit, els.bodyKit);
    renderTotals();
  }

  function buildOrderSummary(){
    const name = (els.cName.value || "").trim() || "Client";
    const contact = (els.cContact.value || "").trim();
    const address = (els.cAddress.value || "").trim();
    const notes = (els.cNotes.value || "").trim();
    const totals = computeTotals();
    const indItems = Array.from(cartInd.values()).sort((a,b) => String(a.sku).localeCompare(String(b.sku)));
    const kitItems = Array.from(cartKit.values()).sort((a,b) => String(a.sku).localeCompare(String(b.sku)));

    const itemLines = [];
    function pushItems(label, arr){
      if (!arr.length) return;
      itemLines.push(`${label}:`);
      arr.forEach(it => {
        const q = clampInt(it.qty, 1, 999);
        const line = money(nnum(it.price) * q);
        itemLines.push(`${it.sku} x${q} ‚Äî ${it.name} @ ${money(it.price)} = ${line}`);
      });
      itemLines.push("");
    }

    pushItems("Individual", indItems);
    pushItems("Kits", kitItems);

    const itemsList = itemLines.length ? itemLines.join("\n").trim() : "(no items)";

    const lines = [];
    lines.push("ORDER SUMMARY");
    lines.push("");
    lines.push("Customer Details");
    lines.push("");
    lines.push(`Name: ${name}`);
    lines.push(`Contact: ${contact || "N/A"}`);
    if (address) lines.push(`Address: ${address}`);
    if (notes) lines.push(`Notes: ${notes}`);
    lines.push("");
    lines.push("Order Items");
    lines.push("");
    lines.push("Kits:");
    if (kitItems.length){
      kitItems.forEach(it => {
        const q = clampInt(it.qty, 1, 999);
        const line = money(nnum(it.price) * q);
        lines.push(`${q}x ${it.name} ‚Äî ${line}`);
      });
    } else {
      lines.push("- (none)");
    }
    lines.push("");
    lines.push("Individual Items:");
    if (indItems.length){
      indItems.forEach(it => {
        const q = clampInt(it.qty, 1, 999);
        const line = money(nnum(it.price) * q);
        lines.push(`${q}x ${it.name} ‚Äî ${line}`);
      });
    } else {
      lines.push("- (none)");
    }
    lines.push("");
    lines.push("Payment Breakdown");
    lines.push("");
    lines.push(`Individual Subtotal: ${money(totals.ind.subtotal)}`);
    lines.push(`Kits Subtotal: ${money(totals.kit.subtotal)}`);
    lines.push(`Items Subtotal: ${money(totals.itemsSubtotal)}`);
    lines.push(`Shipping: ${money(totals.shipping)}`);
    lines.push(`TOTAL DUE: ${money(totals.total)}`);

    return lines.join("\n");
  }

  const carouselImages = Array.from({length:12}, (_,i) => `${i+1}pic.png`);
  let carouselIdx = 0;
  let carouselTimer = null;

  function setOverlayImage(){
    if (!els.overlayBg) return;
    const img = carouselImages[carouselIdx % carouselImages.length];
    els.overlayBg.style.backgroundImage = `url('${img}')`;
  }

  function startCarousel(){
    stopCarousel();
    setOverlayImage();
    carouselTimer = setInterval(() => {
      carouselIdx = (carouselIdx + 1) % carouselImages.length;
      setOverlayImage();
    }, 2200);
  }

  function stopCarousel(){
    if (carouselTimer){
      clearInterval(carouselTimer);
      carouselTimer = null;
    }
  }

  function showOverlay(){
    if (!els.overlay) return;
    carouselIdx = 0;
    setOverlayImage();
    startCarousel();
    els.overlay.style.display = "flex";
    document.body.style.overflow = "hidden";
  }

  function hideOverlay(){
    if (!els.overlay) return;
    stopCarousel();
    els.overlay.style.display = "none";
    document.body.style.overflow = "";
  }

  /* -----------------------------
     PDF INVOICE (combined)
  ----------------------------- */
  async function downloadPDF(){
    const contactCheck = requireContact();
    if (!contactCheck) return;
    if (cartInd.size === 0 && cartKit.size === 0){
      toast("Add at least one item first");
      return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "mm", format: "a4" });

    const dateStr = new Date().toLocaleDateString();
    const name = (els.cName.value || "").trim() || "Client";
    const contact = (els.cContact.value || "").trim();
    const address = (els.cAddress.value || "").trim();
    const notes = (els.cNotes.value || "").trim();

    const invNum = "INV-" + dateStr.replace(/\//g, "");

    const totals = computeTotals();

    async function tryAddImage(path){
      return new Promise((resolve) => {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => {
          try{
            const maxW = 45, maxH = 18;
            let w = maxW, h = (img.height / img.width) * w;
            if (h > maxH){ h = maxH; w = (img.width / img.height) * h; }
            doc.addImage(img, "PNG", 196 - w, 12, w, h);
          } catch(_e){}
          resolve();
        };
        img.onerror = () => resolve();
        img.src = path;
      });
    }

    await tryAddImage("zyl-logo.png");

    doc.setFont("helvetica","bold");
    doc.setFontSize(20);
    doc.setTextColor(40, 40, 40);
    doc.text("INVOICE", 14, 18);

    doc.setFontSize(11);
    doc.setFont("helvetica","bold");
    doc.text("Zhuo Yue Labs", 14, 26);

    doc.setFont("helvetica","normal");
    doc.setFontSize(9.5);
    doc.setTextColor(100, 100, 100);
    doc.text("Order Summary ‚Äî Individual + Kits", 14, 31);

    doc.setDrawColor(120);
    doc.setLineWidth(0.5);
    doc.line(14, 35, 196, 35);

    const startY = 42;

    doc.setFont("helvetica","bold");
    doc.setTextColor(0,0,0);
    doc.text("Bill To:", 14, startY);

    doc.setFont("helvetica","normal");
    doc.text(String(name), 14, startY + 6);

    let yCursor = startY + 12;
    if (contact){
      doc.setTextColor(60,60,60);
      doc.text(String(contact), 14, yCursor);
      yCursor += 5;
      doc.setTextColor(0,0,0);
    }
    if (address){
      doc.setTextColor(60,60,60);
      const addrLines = doc.splitTextToSize(String(address), 90);
      doc.text(addrLines, 14, yCursor);
      yCursor += (addrLines.length * 4.2);
      doc.setTextColor(0,0,0);
    }

    const rightX = 132;
    doc.setFont("helvetica","bold");
    doc.text("Details:", rightX, startY);

    doc.setFont("helvetica","normal");
    doc.setTextColor(60,60,60);
    doc.text("Invoice #:", rightX, startY + 6);
    doc.text(String(invNum), rightX + 22, startY + 6);

    doc.text("Date:", rightX, startY + 11);
    doc.text(String(dateStr), rightX + 22, startY + 11);

    doc.text("Shipping:", rightX, startY + 16);
    doc.text(money(shippingRate), rightX + 22, startY + 16);

    doc.setTextColor(0,0,0);

    const indItems = Array.from(cartInd.values()).sort((a,b) => String(a.sku).localeCompare(String(b.sku)));
    const kitItems = Array.from(cartKit.values()).sort((a,b) => String(a.sku).localeCompare(String(b.sku)));

    const bodyRows = [];

    function pushGroup(title){
      bodyRows.push([{ content: title, colSpan: 5, styles: { fillColor: [245,245,245], textColor: [40,40,40], fontStyle: "bold" } }]);
    }

    function pushItems(items){
      items.forEach(it => {
        const q = clampInt(it.qty, 1, 999);
        const line = nnum(it.price) * q;
        bodyRows.push([
          String(it.name),
          String(it.sku),
          String(q),
          money(it.price),
          money(line)
        ]);
      });
      if (!items.length){
        bodyRows.push(["(No items)","","","",""]);
      }
    }

    pushGroup("INDIVIDUAL");
    pushItems(indItems);

    pushGroup("KITS");
    pushItems(kitItems);

    pushGroup("FEES");
    bodyRows.push(["Shipping (Auto)", "", "", money(shippingRate), money(shippingRate)]);

    doc.autoTable({
      startY: startY + 34,
      head: [["Item Description", "Code", "Qty", "Unit", "Line Total"]],
      body: bodyRows,
      theme: "striped",
      headStyles: { fillColor: [228, 0, 0], textColor: 255 },
      columnStyles: {
        0: { cellWidth: 90 },
        1: { cellWidth: 30 },
        2: { cellWidth: 16, halign: "right" },
        3: { cellWidth: 28, halign: "right" },
        4: { cellWidth: 30, halign: "right" }
      }
    });

    const afterTableY = doc.lastAutoTable.finalY + 10;

    doc.setFont("helvetica","bold");
    doc.setTextColor(0,0,0);
    doc.text("Totals", 14, afterTableY);

    doc.setFont("helvetica","normal");
    doc.setTextColor(60,60,60);
    doc.text(`Individual Subtotal: ${money(totals.ind.subtotal)}`, 14, afterTableY + 6);
    doc.text(`Kits Subtotal: ${money(totals.kit.subtotal)}`, 14, afterTableY + 11);
    doc.text(`Items Subtotal: ${money(totals.itemsSubtotal)}`, 14, afterTableY + 16);
    doc.text(`Shipping: ${money(totals.shipping)}`, 14, afterTableY + 21);

    doc.setFont("helvetica","bold");
    doc.setTextColor(0,0,0);
    doc.text(`Total Due: ${money(totals.total)}`, 14, afterTableY + 28);

    if (notes){
      doc.setFont("helvetica","bold");
      doc.setTextColor(0,0,0);
      doc.text("Notes:", 14, afterTableY + 40);
      doc.setFont("helvetica","normal");
      doc.setTextColor(60,60,60);
      const noteLines = doc.splitTextToSize(String(notes), 182);
      doc.text(noteLines, 14, afterTableY + 46);
    }

    doc.setFontSize(9.5);
    doc.setTextColor(110,110,110);
    doc.text("Thank you for your business!", 105, 290, { align: "center" });

    const safeName = String(name).replace(/[^a-z0-9]/gi, "_").slice(0, 40) || "Client";
    const safeDate = String(dateStr).replace(/\//g, "-");
    doc.save(`Invoice_${safeName}_${safeDate}.pdf`);
  }

  /* -----------------------------
     SUBMIT ORDER (EmailJS)
  ----------------------------- */
  async function submitOrder(){
    const contact = requireContact();
    if (!contact) return;

    if (cartInd.size === 0 && cartKit.size === 0){
      toast("Add at least one item first", "error");
      return;
    }
    if (!window.emailjs || !emailjs.send){
      toast("Email service unavailable", "error");
      return;
    }

    const message = buildOrderSummary();

    toast("Sending...");
    try{
      await emailjs.send("service_188im68", "template_m6msd8i", {
        message,
        to_name: "Admin",
        from_name: (els.cName.value || "").trim() || "Client",
        contact
      });
      toast("Order Sent!");
      showOverlay();
    } catch(err){
      console.error(err);
      toast("Send failed ‚Äî try again", "error");
    }
  }

  /* -----------------------------
     INIT + EVENTS
  ----------------------------- */
  (function init(){
    const today = new Date();
    els.todayLabel.textContent = "Date: " + today.toLocaleDateString();
    loadPersisted();
    setCountryShipping(els.countrySelect.value || "US");
    renderAll();
    document.getElementById("orderApp").style.display = "block";
    document.body.style.overflow = "hidden";

    // persist info fields on edit
    ["input","change"].forEach(evt => {
      els.cName.addEventListener(evt, persist);
      els.cContact.addEventListener(evt, persist);
      els.cAddress.addEventListener(evt, persist);
      els.cNotes.addEventListener(evt, persist);
    });
    els.countrySelect.addEventListener("change", persist);
  })();

  // attach searches (separate, independent dropdowns)
  attachSearch({
    inputEl: els.searchInd,
    resultsEl: els.resultsInd,
    catalog: CATALOG_INDIVIDUAL,
    onAdd: (sku) => addToCart(cartInd, CATALOG_INDIVIDUAL, sku)
  });

  attachSearch({
    inputEl: els.searchKit,
    resultsEl: els.resultsKit,
    catalog: CATALOG_KITS,
    onAdd: (sku) => addToCart(cartKit, CATALOG_KITS, sku)
  });

  els.clearIndBtn.addEventListener("click", () => { clearCart(cartInd); toast("Cleared individual cart"); });
  els.clearKitBtn.addEventListener("click", () => { clearCart(cartKit); toast("Cleared kits cart"); });
  els.clearAllBtn.addEventListener("click", clearBoth);
  els.countrySelect.addEventListener("change", (e) => setCountryShipping(e.target.value));

  els.pdfBtn.addEventListener("click", () => downloadPDF());
  els.submitBtn.addEventListener("click", () => submitOrder());
  els.backBtn.addEventListener("click", hideOverlay);
  els.newOrderBtn.addEventListener("click", () => {
    clearBoth();
    els.cName.value = "";
    els.cContact.value = "";
    els.cAddress.value = "";
    els.cNotes.value = "";
    els.countrySelect.value = "US";
    setCountryShipping("US");
    renderAll();
    hideOverlay();
  });
  const homeIntro = document.getElementById("homeIntro");
  const homeStartBtn2 = document.getElementById("homeStartBtn2");
  const homeBtn = document.getElementById("homeBtn");
  const viewProductsBtn = document.getElementById("viewProductsBtn");
  homeStartBtn2.addEventListener("click", () => {
    homeIntro.style.display = "none";
    document.body.style.overflow = "";
  });
  homeBtn.addEventListener("click", () => {
    homeIntro.style.display = "grid";
    document.body.style.overflow = "hidden";
  });
  viewProductsBtn.addEventListener("click", () => {
    window.location.href = "products.html";
  });

</script>
</body>
</html>
